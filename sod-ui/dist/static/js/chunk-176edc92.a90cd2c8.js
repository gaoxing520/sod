(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-176edc92"],{3069:function(e,t,r){"use strict";var o=r("ec01"),a=r.n(o);a.a},"70bc":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{staticClass:"handleExport"},[r("el-form",{ref:"ruleForm",attrs:{rules:e.rules,model:e.msgFormDialog,"label-width":"140px"}},[r("el-row",[r("el-col",{attrs:{span:10}},[r("el-form-item",{attrs:{label:"任务名称",prop:"taskName"}},[r("el-input",{attrs:{size:"small"},model:{value:e.msgFormDialog.taskName,callback:function(t){e.$set(e.msgFormDialog,"taskName",t)},expression:"msgFormDialog.taskName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"数据库IP"}},[r("el-select",{attrs:{size:"small",filterable:""},on:{change:e.findTree},model:{value:e.msgFormDialog.databaseId,callback:function(t){e.$set(e.msgFormDialog,"databaseId",t)},expression:"msgFormDialog.databaseId"}},e._l(e.ipList,(function(e,t){return r("el-option",{key:t,attrs:{label:e.VAULE,value:e.KEY}})})),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"类型",prop:"checked"}},[r("el-checkbox-group",{model:{value:e.msgFormDialog.checked,callback:function(t){e.$set(e.msgFormDialog,"checked",t)},expression:"msgFormDialog.checked"}},[r("el-checkbox",{attrs:{label:"结构"}},[e._v("结构")]),e._v(" "),r("el-checkbox",{attrs:{label:"数据"}},[e._v("数据")])],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:20}},[r("el-form-item",{attrs:{label:"执行策略",prop:"jobCron"}},[r("el-input",{attrs:{size:"small"},model:{value:e.msgFormDialog.jobCron,callback:function(t){e.$set(e.msgFormDialog,"jobCron",t)},expression:"msgFormDialog.jobCron"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:4}},[r("el-form-item",{staticClass:"unitFormItem"},[r("el-button",{staticStyle:{padding:"9px 0",width:"100%"},attrs:{size:"small",type:"primary"},on:{click:function(t){e.cronDialogVisible=!0}}},[e._v("配置策略")])],1)],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"存储目录"}},[r("el-select",{attrs:{size:"small",filterable:""},model:{value:e.msgFormDialog.storageDirectory,callback:function(t){e.$set(e.msgFormDialog,"storageDirectory",t)},expression:"msgFormDialog.storageDirectory"}},e._l(e.storageDirectoryOptions,(function(e){return r("el-option",{key:e.dictValue,attrs:{label:e.dictLabel,value:e.dictValue}})})),1)],1)],1),e._v(" "),r("el-col",{attrs:{span:14}},[r("el-form-item",{attrs:{label:"数据库对象"}},[r("el-scrollbar",{attrs:{"wrap-class":"scrollbar-wrapper"}},[r("el-tree",{ref:"eltree",attrs:{"node-key":"nodeKey","show-checkbox":"",data:e.treedata,props:e.defaultProps,"default-checked-keys":e.defaultChecked}})],1)],1)],1)],1),e._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.msgFormDialog.conditions,expression:"msgFormDialog.conditions"}],attrs:{label:"where条件"}},[r("el-input",{attrs:{size:"small",disabled:!0},model:{value:e.msgFormDialog.conditions,callback:function(t){e.$set(e.msgFormDialog,"conditions",t)},expression:"msgFormDialog.conditions"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.trueDialog("ruleForm","handExe")}}},[e._v("手工执行元数据备份")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.trueDialog("ruleForm","handtrue")}}},[e._v("确 定")]),e._v(" "),r("el-button",{on:{click:function(t){return e.cancelDialog("ruleForm")}}},[e._v("取 消")])],1),e._v(" "),e.cronDialogVisible?r("Cron",{attrs:{"append-to-body":"",cronDialogVisible:e.cronDialogVisible},on:{closeCron:e.closeCron,setCron:e.setCron}}):e._e()],1)},a=[],n=(r("ac6a"),r("28a5"),r("96cf"),r("3b8d")),s=r("3d09"),i=r("4b67"),c=r("9600"),l={name:"handleExport",props:{handleObj:{type:Object}},components:{Cron:s["a"]},data:function(){return{treeJson:[],storageDirectoryOptions:[],cronDialogVisible:!1,defaultChecked:[],msgFormDialog:{taskName:"",databaseId:"",checked:[],jobCron:"",storageDirectory:"",conditions:""},ipList:[],defaultProps:{children:"children",label:"name"},treedata:[],rules:{taskName:[{required:!0,message:"请输入任务名称",trigger:"blur"}],databaseId:[{required:!0,message:"请选择数据库IP",trigger:"change"}],checked:[{required:!0,message:"请选择类型",trigger:"change"}],jobCron:[{required:!0,message:"请输入执行策略",trigger:"blur"}],storageDirectory:[{required:!0,message:"请选择存储目录",trigger:"change"}]}}},created:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,r,o=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["h"])().then((function(e){o.ipList=e.data}));case 2:return e.next=4,this.getDicts("metabackup_storage_directory").then((function(e){o.storageDirectoryOptions=e.data}));case 4:if(!this.handleObj.id){e.next=15;break}return this.msgFormDialog=this.handleObj,this.msgFormDialog.checked=[],t=this.msgFormDialog.isStructure.split(","),t.forEach((function(e){"0"==e&&o.msgFormDialog.checked.push("结构"),"1"==e&&o.msgFormDialog.checked.push("数据")})),e.next=11,this.findTree(this.msgFormDialog.databaseId);case 11:r=JSON.parse(this.msgFormDialog.backContent),this.defaultChecked=[],r.forEach((function(e){o.treeJson.forEach((function(t){e.nodeKey==t.nodeKey&&o.defaultChecked.push(e.nodeKey)}))})),console.log(this.defaultChecked);case 15:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),methods:{findTree:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["i"])({databaseId:t}).then((function(e){r.treeJson=e.data,r.treeJson.forEach((function(e){e.nodeKey=e.pid+"+"+e.id})),r.treedata=Object(i["h"])(r.treeJson,""),console.log(r.treedata)}));case 2:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),handExe:function(e){this.msgFormDialog.triggerStatus=1},trueDialog:function(e,t){var r=this;this.msgFormDialog.triggerStatus=1;var o=this.$refs.eltree.getHalfCheckedKeys(),a=this.$refs.eltree.getCheckedKeys();if(0!=a.length){var n=[];a.forEach((function(e){r.treeJson.forEach((function(t){if(e==t.nodeKey){var r={};r=t,n.push(r)}}))})),o.forEach((function(e){r.treeJson.forEach((function(t){if(e==t.nodeKey){var r={};r=t,n.push(r)}}))})),this.msgFormDialog.backContent=JSON.stringify(n),this.msgFormDialog.isStructure=[],this.msgFormDialog.checked.forEach((function(e){"结构"==e&&r.msgFormDialog.isStructure.push("0"),"数据"==e&&r.msgFormDialog.isStructure.push("1")})),this.msgFormDialog.isStructure=this.msgFormDialog.isStructure.join(","),console.log(this.msgFormDialog),this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;"handtrue"==t?r.handleObj.id?Object(c["d"])(r.msgFormDialog).then((function(e){200===e.code?(r.msgSuccess("修改成功"),r.$emit("cancelHandle")):r.msgError(e.msg)})):Object(c["a"])(r.msgFormDialog).then((function(e){200===e.code?(r.msgSuccess("新增成功"),r.$emit("cancelHandle")):r.msgError(e.msg)})):r.$prompt("请输入where条件","温馨提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(e){var t=e.value;r.msgFormDialog.conditions=t,Object(c["j"])(r.msgFormDialog).then((function(e){200===e.code?(r.msgSuccess("新增成功"),r.$emit("cancelHandle")):r.msgError(e.msg)}))})).catch((function(){}))}))}else this.msgError("请选择数据库对象")},cancelDialog:function(e){this.$emit("cancelHandle")},setCron:function(e){this.msgFormDialog.jobCron=e,this.cronDialogVisible=!1},closeCron:function(){this.cronDialogVisible=!1}}},u=l,m=(r("3069"),r("2877")),d=Object(m["a"])(u,o,a,!1,null,null,null);t["default"]=d.exports},9600:function(e,t,r){"use strict";r.d(t,"h",(function(){return n})),r.d(t,"n",(function(){return s})),r.d(t,"m",(function(){return i})),r.d(t,"o",(function(){return c})),r.d(t,"e",(function(){return l})),r.d(t,"p",(function(){return u})),r.d(t,"i",(function(){return m})),r.d(t,"a",(function(){return d})),r.d(t,"d",(function(){return g})),r.d(t,"j",(function(){return h})),r.d(t,"k",(function(){return f})),r.d(t,"l",(function(){return p})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return D})),r.d(t,"g",(function(){return k})),r.d(t,"f",(function(){return F}));var o=r("b775"),a="http://10.40.79.18:8005";function n(){return Object(o["a"])({url:a+"/schedule/metaBackup/findDataBase",method:"get"})}function s(e){return Object(o["a"])({url:a+"/schedule/metaBackup/list",method:"get",params:e})}function i(e){return Object(o["a"])({url:a+"/schedule/metaBackup/"+e,method:"DELETE"})}function c(e){return Object(o["a"])({url:a+"/schedule/job/startById",method:"get",params:{id:e}})}function l(e){return Object(o["a"])({url:a+"/schedule/job/execute",method:"get",params:{id:e}})}function u(e){return Object(o["a"])({url:a+"/schedule/job/stop",method:"get",params:{id:e}})}function m(e){return Object(o["a"])({url:a+"/schedule/metaBackup/findMeta",method:"get",params:e})}function d(e){return Object(o["a"])({url:a+"/schedule/metaBackup",method:"post",data:e})}function g(e){return Object(o["a"])({url:a+"/schedule/metaBackup",method:"put",data:e})}function h(e){return Object(o["a"])({url:a+"/schedule/metaBackup/handExecute",method:"get",params:e})}function f(e){return Object(o["a"])({url:a+"/schedule/metaBackupLog/list",method:"get",params:e})}function p(e){return Object(o["a"])({url:a+"/schedule/metaBackupLog/"+e,method:"get"})}function b(e){return Object(o["a"])({url:a+"/schedule/metaBackupLog/"+e,method:"delete"})}function D(e){return Object(o["a"])({url:a+"/api/schedule/uploadDown/downFile",method:"get",params:e,responseType:"arraybuffer"})}function k(e){return Object(o["a"])({url:a+"/schedule/metaBackupLog/export",method:"get",params:e,responseType:"arraybuffer"})}function F(e){return Object(o["a"])({url:a+"/schedule/metaBackup/export",method:"get",params:e,responseType:"arraybuffer"})}},ec01:function(e,t,r){}}]);