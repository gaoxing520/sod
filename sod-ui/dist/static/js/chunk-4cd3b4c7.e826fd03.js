(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4cd3b4c7","chunk-708f6d9b"],{1626:function(e,t,a){"use strict";var o=a("f0e5"),l=a.n(o);l.a},"33a7":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container commonMetadataTem"},[a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"同步任务配置",name:"first"}},[a("el-row",{staticClass:"handleTableBox",attrs:{gutter:10}},[a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["system:commonMetadataSync:add"],expression:"['system:commonMetadataSync:add']"}],attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.showAddDialog()}}},[e._v("新增同步任务")])],1),e._v(" "),a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["system:commonMetadataSync:add"],expression:"['system:commonMetadataSync:add']"}],attrs:{size:"small",type:"success",icon:"el-icon-set-up"},on:{click:function(t){return e.syncCommonMetadata()}}},[e._v("立即同步元数据")])],1),e._v(" "),a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["system:commonMetadataSync:add"],expression:"['system:commonMetadataSync:add']"}],attrs:{size:"small",type:"danger",icon:"el-icon-delete"},on:{click:function(t){return e.deleteShow()}}},[e._v("删除同步任务")])],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,"row-key":"id","highlight-current-row":""},on:{"selection-change":e.handleTaskSelectionChange}},[a("el-table-column",{attrs:{type:"index",width:"40",index:e.table_index}}),e._v(" "),a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"taskName",sortable:"",label:"任务名称","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"tableName",sortable:"",label:"表名","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"apiUrl",label:"接口url",width:"350px","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"apiType",label:"同步类型",formatter:e.statusFormat,width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"apiDataKey",label:"接口关键字"}}),e._v(" "),a("el-table-column",{attrs:{prop:"jobCron",label:"执行策略"}}),e._v(" "),a("el-table-column",{attrs:{prop:"description",label:"来源","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"160px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit"},on:{click:function(a){return e.showEditDialog(t.row)}}},[e._v("修改")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-reading"},on:{click:function(a){return e.viewDaily(t.row)}}},[e._v("查询日志")])]}}])})],1),e._v(" "),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"同步记录查询",name:"second"}},[a("el-form",{ref:"rowlogForm",staticClass:"searchBox",attrs:{model:e.rowlogForm,inline:!0}},[a("el-form-item",{attrs:{label:"同步表名"}},[a("el-select",{staticStyle:{width:"200px"},attrs:{filterable:""},model:{value:e.rowlogForm.syncTableName,callback:function(t){e.$set(e.rowlogForm,"syncTableName",t)},expression:"rowlogForm.syncTableName"}},e._l(e.tableNames,(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"运行状态"}},[a("el-select",{staticStyle:{width:"150px"},attrs:{filterable:""},model:{value:e.rowlogForm.runState,callback:function(t){e.$set(e.rowlogForm,"runState",t)},expression:"rowlogForm.runState"}},[a("el-option",{attrs:{value:"同步成功",label:"同步成功"}}),e._v(" "),a("el-option",{attrs:{value:"同步失败",label:"同步失败"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"时间范围"}},[a("el-date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetimerange","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-search"},on:{click:e.dataBaseExpandForm}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{size:"small",icon:"el-icon-refresh-right"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),e._v(" "),a("el-row",{staticClass:"handleTableBox",attrs:{gutter:10}},[a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["system:commonMetadataSync:delete"],expression:"['system:commonMetadataSync:delete']"}],attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:e.deleteRecord}},[e._v("删除")])],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingHis,expression:"loadingHis"}],attrs:{data:e.logTableData,"highlight-current-row":""},on:{"selection-change":e.handleHistorySelectionChange}},[a("el-table-column",{attrs:{type:"index",width:"40",index:e.table_index_log}}),e._v(" "),a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"startTime",label:"开始时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.parseTime(t.row.startTime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"stopTime",label:"结束时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.parseTime(t.row.stopTime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"syncTableName",label:"同步表名","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"syncRecordNum",label:"同步记录数"}}),e._v(" "),a("el-table-column",{attrs:{prop:"syncType",label:"同步类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.syncType?a("span",[e._v("全量同步")]):e._e(),e._v(" "),2==t.row.syncType?a("span",[e._v("增量同步")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"syncModel",label:"同步方式"}}),e._v(" "),a("el-table-column",{attrs:{prop:"runState",label:"运行状态"}})],1),e._v(" "),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.logDataTotal>0,expression:"logDataTotal>0"}],attrs:{total:e.logDataTotal,page:e.rowlogForm.pageNum,limit:e.rowlogForm.pageSize},on:{"update:page":function(t){return e.$set(e.rowlogForm,"pageNum",t)},"update:limit":function(t){return e.$set(e.rowlogForm,"pageSize",t)},pagination:e.dataBaseExpandForm}})],1)],1),e._v(" "),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:e.dialogTitle,visible:e.handleDialog,width:"650px"},on:{"update:visible":function(t){e.handleDialog=t}}},[e.handleDialog?a("handleSod",{attrs:{handleObj:e.handleObj},on:{cancelHandle:e.cancelHandle}}):e._e()],1),e._v(" "),e.syncDescDialogVisible?a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"同步详情",visible:e.syncDescDialogVisible},on:{"update:visible":function(t){e.syncDescDialogVisible=t}}},[e._l(e.syncDescList,(function(t,o){return a("div",{key:o},["同步成功"==t.run_state?a("div",[a("span",[e._v("同步表名"+e._s(o)+":"+e._s(t.syncTableName))]),e._v(" "),a("span",[e._v("同步记录数"+e._s(o)+":"+e._s(t.syncRecordNum))])]):a("div",[a("span",[e._v("同步表名"+e._s(o)+":"+e._s(t.syncTableName))]),e._v(" "),a("span",[e._v("同步状态:"+e._s(t.run_state))]),e._v(" "),a("span",[e._v("失败原因:"+e._s(t.fail_reason))])])])})),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.cancelHandle()}}},[e._v("确 定")])],1)],2):e._e()],1)},l=[],n=a("97fe"),s=(a("9f8d"),a("db16")),r={components:{handleSod:s["default"]},data:function(){return{activeName:"first",loading:!0,queryParams:{pageNum:1,pageSize:10},tableData:[],total:0,dialogTitle:"",handleDialog:!1,handleObj:{},syncDescDialogVisible:!1,syncDescList:[],currentRow:[],dateRange:[],loadingHis:!1,rowlogForm:{pageNum:1,pageSize:10,syncTableName:"",runState:""},logTableData:[],logDataTotal:0,tableNames:[]}},created:function(){this.getList(),this.getTableNames()},methods:{getTableNames:function(){},table_index:function(e){return(this.queryParams.pageNum-1)*this.queryParams.pageSize+e+1},table_index_log:function(e){return(this.rowlogForm.pageNum-1)*this.rowlogForm.pageSize+e+1},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},getList:function(){var e=this;this.loading=!0,Object(n["f"])(this.queryParams).then((function(t){e.tableData=t.data.pageData,e.total=t.data.totalCount,e.loading=!1}))},showAddDialog:function(){this.handleObj={},this.handleDialog=!0,this.dialogTitle="新增同步任务"},syncCommonMetadata:function(){var e=this,t=[],a=[];if(0!=this.currentRow.length){for(var o in this.currentRow)t.push(this.currentRow[o].id),a.push(this.currentRow[o].apiType);var l=this.$loading({lock:!0,text:"执行同步任务中,请勿有其他操作！",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),s={ids:t.join(","),apiType:a.join(",")};Object(n["h"])(s).then((function(t){200==t.code?(e.$message({type:"success",message:"同步成功"}),l.close(),e.syncDescList=t.data.data,e.syncDescDialogVisible=!0):(e.$message({type:"error",message:"同步失败"}),l.close())}))}else this.$message({type:"info",message:"请选择一行数据"})},deleteShow:function(){var e=this,t=[];if(0!=this.currentRow.length){for(var a in this.currentRow)t.push(this.currentRow[a].id);console.log(t),this.$confirm("数据删除后将无法恢复，确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(n["b"])({ids:t.join(",")}).then((function(t){200==t.code?(e.$message({type:"success",message:"删除成功"}),e.handleQuery()):e.$message({type:"error",message:"删除失败"})}))})).catch((function(){}))}else this.$message({type:"info",message:"请选择一行数据"})},handleClick:function(e,t){"first"==this.activeName&&this.handleQuery(),"second"==this.activeName&&this.dataBaseExpandForm()},statusFormat:function(e,t,a){return 1==a?"全量同步":2==a?"增量同步":a},showEditDialog:function(e){this.handleObj=e,this.handleDialog=!0,this.dialogTitle="编辑同步任务"},viewDaily:function(e){this.activeName="second",this.rowlogForm.name=e.tableName,this.resetQuery()},deleteRecord:function(){var e=this,t=[];if(0!=this.currentRow.length){for(var a in this.currentRow)t.push(this.currentRow[a].id);console.log(t),this.$confirm("数据删除后将无法恢复，确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(n["c"])({ids:t.join(",")}).then((function(t){200==t.code?(e.$message({type:"success",message:"删除成功"}),e.resetQuery()):e.$message({type:"error",message:"删除失败"})}))})).catch((function(){}))}else this.$message({type:"error",message:"请选择一行数据"})},handleTaskSelectionChange:function(e){this.currentRow=e},handleHistorySelectionChange:function(e){this.currentRow=e},cancelHandle:function(){this.handleObj={},this.currentRow=[],this.syncDescList=[],this.syncDescDialogVisible=!1,this.handleDialog=!1,this.handleQuery()},resetQuery:function(){this.dateRange=[],this.rowlogForm.pageNum=1,this.dataBaseExpandForm()},dataBaseExpandForm:function(){var e=this;this.loadingHis=!0,console.log(this.rowlogForm),Object(n["g"])(this.addDateRange(this.rowlogForm,this.dateRange)).then((function(t){e.logTableData=t.data.pageData,e.logDataTotal=t.data.totalCount,e.loadingHis=!1}))}}},i=r,c=(a("8d7a"),a("2877")),m=Object(c["a"])(i,o,l,!1,null,null,null);t["default"]=m.exports},"8d7a":function(e,t,a){"use strict";var o=a("8e6e"),l=a.n(o);l.a},"8e6e":function(e,t,a){},"97fe":function(e,t,a){"use strict";a.d(t,"f",(function(){return n})),a.d(t,"g",(function(){return s})),a.d(t,"a",(function(){return r})),a.d(t,"d",(function(){return i})),a.d(t,"b",(function(){return c})),a.d(t,"c",(function(){return m})),a.d(t,"h",(function(){return u})),a.d(t,"e",(function(){return d}));var o=a("b775"),l="http://10.40.79.18:8005";function n(e){return Object(o["a"])({url:l+"/comMetaData/page",method:"get",params:e})}function s(e){return Object(o["a"])({url:l+"/comMetaData/recordPage",method:"get",params:e})}function r(e){return Object(o["a"])({url:l+"/comMetaData/addConfig",method:"post",params:e})}function i(e){return Object(o["a"])({url:l+"/comMetaData/editConfig",method:"put",params:e})}function c(e){return Object(o["a"])({url:l+"/comMetaData/delConfig",method:"delete",params:e})}function m(e){return Object(o["a"])({url:l+"/comMetaData/delRecord",method:"delete",params:e})}function u(e){return Object(o["a"])({url:l+"/comMetaData/syncDataNow",method:"get",params:e})}function d(e){return Object(o["a"])({url:l+"/comMetaData/findCfgByPk",method:"get",params:e})}},"9f8d":function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var o=a("b775"),l="http://10.40.79.18:8005";function n(){return Object(o["a"])({url:l+"/system/dict/data/dictType/sys_mmd_sync_table",method:"get"})}},db16:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"handleTaskCommonDialog"},[a("el-form",{ref:"ruleForm",attrs:{rules:e.rules,model:e.msgFormDialog,"label-width":"100px"}},[a("el-form-item",{attrs:{prop:"taskName",label:"任务名称:"}},[a("el-input",{attrs:{size:"small",placeholder:"请输入"},model:{value:e.msgFormDialog.taskName,callback:function(t){e.$set(e.msgFormDialog,"taskName",t)},expression:"msgFormDialog.taskName"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"tableName",label:"表名:"}},[a("el-select",{attrs:{size:"small",filterable:""},model:{value:e.msgFormDialog.tableName,callback:function(t){e.$set(e.msgFormDialog,"tableName",t)},expression:"msgFormDialog.tableName"}},e._l(e.tableNames,(function(e,t){return a("el-option",{key:t,attrs:{label:e.dictValue,value:e.dictValue}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"apiUrl",label:"接口url:"}},[a("el-input",{attrs:{size:"small",placeholder:"请输入"},model:{value:e.msgFormDialog.apiUrl,callback:function(t){e.$set(e.msgFormDialog,"apiUrl",t)},expression:"msgFormDialog.apiUrl"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"apiType",label:"同步类型:"}},[a("el-select",{attrs:{size:"small",filterable:""},model:{value:e.msgFormDialog.apiType,callback:function(t){e.$set(e.msgFormDialog,"apiType",t)},expression:"msgFormDialog.apiType"}},[a("el-option",{attrs:{label:"全量同步",value:"1"}}),e._v(" "),a("el-option",{attrs:{label:"增量同步",value:"2"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"apiDataKey",label:"接口关键字:"}},[a("el-input",{attrs:{size:"small",placeholder:"请输入"},model:{value:e.msgFormDialog.apiDataKey,callback:function(t){e.$set(e.msgFormDialog,"apiDataKey",t)},expression:"msgFormDialog.apiDataKey"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"primaryKey",label:"同步主键:"}},[a("el-input",{attrs:{size:"small",placeholder:"请输入"},model:{value:e.msgFormDialog.primaryKey,callback:function(t){e.$set(e.msgFormDialog,"primaryKey",t)},expression:"msgFormDialog.primaryKey"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"jobCron",label:"执行策略:"}},[a("el-row",[a("el-col",{attrs:{span:18}},[a("el-input",{attrs:{size:"small",placeholder:"请输入"},model:{value:e.msgFormDialog.jobCron,callback:function(t){e.$set(e.msgFormDialog,"jobCron",t)},expression:"msgFormDialog.jobCron"}})],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.showStrategyDialog()}}},[e._v("配置策略")])],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.trueDialog("ruleForm")}}},[e._v("确 定")]),e._v(" "),a("el-button",{on:{click:function(t){return e.cancelDialog("ruleForm")}}},[e._v("取 消")])],1),e._v(" "),e.cronDialogVisible?a("Cron",{attrs:{"append-to-body":"",cronDialogVisible:e.cronDialogVisible},on:{closeCron:e.closeCron,setCron:e.setCron}}):e._e()],1)},l=[],n=(a("96cf"),a("3b8d")),s=a("97fe"),r=a("9f8d"),i=a("3d09"),c={name:"handleTaskCommonDialog",components:{Cron:i["a"]},props:{handleObj:{type:Object}},data:function(){return{cronDialogVisible:!1,msgFormDialog:{taskName:"",tableName:"",apiUrl:"",apiType:"",apiDataKey:"",primaryKey:"",jobCron:""},tableNames:[],rules:{taskName:[{required:!0,message:"请输入任务名称",trigger:"blur"}],tableName:[{required:!0,message:"选择表名",trigger:"change"}],apiUrl:[{required:!0,message:"请输入接口url",trigger:"blur"}],apiType:[{required:!0,message:"请选择同步类型",trigger:"change"}],apiDataKey:[{required:!0,message:"请输入接口关键字",trigger:"blur"}],jobCron:[{required:!0,message:"请输入执行策略",trigger:"blur"}]}}},created:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.selectAllTaskName();case 2:if(!this.handleObj.id){e.next=5;break}return e.next=5,Object(s["e"])({id:this.handleObj.id}).then((function(e){200==e.code?t.msgFormDialog=e.data:t.$message({type:"error",message:"查询失败"})}));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),methods:{trueDialog:function(e){var t=this;console.log(this.msgFormDialog),this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;t.handleObj.id?Object(s["d"])(t.msgFormDialog).then((function(e){200==e.code?t.$message({type:"success",message:"编辑成功"}):t.$message({type:"error",message:"编辑失败"}),t.$emit("cancelHandle")})):Object(s["a"])(t.msgFormDialog).then((function(e){200==e.code?t.$message({type:"success",message:"新增成功"}):t.$message({type:"error",message:"新增失败"}),t.$emit("cancelHandle")}))}))},cancelDialog:function(e){this.$emit("cancelHandle")},selectAllTaskName:function(){var e=this;Object(r["a"])(this.queryParams).then((function(t){200==t.code&&(e.tableNames=t.data)}))},showStrategyDialog:function(){this.cronDialogVisible=!0},setCron:function(e){this.msgFormDialog.jobCron=e,this.cronDialogVisible=!1},closeCron:function(){this.cronDialogVisible=!1}}},m=c,u=(a("1626"),a("2877")),d=Object(u["a"])(m,o,l,!1,null,null,null);t["default"]=d.exports},f0e5:function(e,t,a){}}]);