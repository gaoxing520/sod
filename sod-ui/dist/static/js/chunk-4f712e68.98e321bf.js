(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4f712e68"],{5018:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-form",{ref:"queryForm",staticClass:"searchBox",attrs:{model:e.queryParams,inline:!0}},[a("el-form-item",{attrs:{label:"专题库名称："}},[a("el-input",{attrs:{size:"small",placeholder:"输入关键字搜索"},model:{value:e.queryParams.database_name,callback:function(t){e.$set(e.queryParams,"database_name",t)},expression:"queryParams.database_name"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-search"},on:{click:e.handleQuery}},[e._v("查询")])],1)],1),e._v(" "),a("el-row",{staticClass:"handleTableBox",attrs:{gutter:10}},[a("el-col",{attrs:{span:1.5}},[a("el-button",{attrs:{size:"small",type:"success",icon:e.exportIcon},on:{click:e.handleExport}},[e._v("生成差异报告")])],1),e._v(" "),a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["consistencyCheck:role:add"],expression:"['consistencyCheck:role:add']"}],attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.addReportData()}}},[e._v("添加")])],1),e._v(" "),a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["consistencyCheck:role:delete"],expression:"['consistencyCheck:role:delete']"}],attrs:{size:"small",type:"danger",icon:"el-icon-delete"},on:{click:e.deleteData}},[e._v("删除")])],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,"row-key":"id"},on:{"selection-change":e.handleCurrentChange}},[a("el-table-column",{attrs:{type:"index",label:" ",index:e.table_index}}),e._v(" "),a("el-table-column",{attrs:{type:"selection",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"databaseName",label:"专题库名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"databaseDto.databaseDefine.databaseType",label:"数据库类型"}}),e._v(" "),a("el-table-column",{attrs:{prop:"databaseDto.databaseDefine.databaseInstance",label:"专题库实例"}}),e._v(" "),a("el-table-column",{attrs:{prop:"databaseDto.schemaName",label:"专题库模式"}}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-tickets",size:"small",type:"text"},on:{click:function(a){return e.getHistoricalReport(t.row)}}},[e._v("历史报告列表")])]}}])})],1),e._v(" "),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}}),e._v(" "),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"添加",visible:e.addDataDialog,width:"40%"},on:{"update:visible":function(t){e.addDataDialog=t}}},[a("el-form",{ref:"ruleForm",attrs:{rules:e.rules,model:e.msgFormDialog}},[a("el-form-item",{attrs:{label:"数据库选择:"}},[a("el-select",{staticStyle:{width:"80%"},attrs:{placeholder:"请选择添加数据库"},on:{change:e.databaseChange},model:{value:e.msgFormDialog.databaseId,callback:function(t){e.$set(e.msgFormDialog,"databaseId",t)},expression:"msgFormDialog.databaseId"}},e._l(e.databaseNameOptions,(function(e){return a("el-option",{key:e.ID,attrs:{label:e.DATABASE_NAME,value:e.ID}})})),1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addReportRecord("ruleForm")}}},[e._v("确 定")]),e._v(" "),a("el-button",{on:{click:function(t){e.addDataDialog=!1}}},[e._v("取 消")])],1)],1),e._v(" "),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"历史报告表",visible:e.historyDialog,width:"80%",height:"50%"},on:{"update:visible":function(t){e.historyDialog=t}}},[a("el-table",{ref:"singleTable",attrs:{data:e.historyData,"highlight-current-row":"",border:"",stripe:""}},[a("el-table-column",{attrs:{type:"index","min-width":"20",label:" ",index:e.table_index_history}}),e._v(" "),a("el-table-column",{attrs:{prop:"fileName",label:"报告名称","min-width":"300"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"生成时间"}}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-tickets",size:"small",type:"text"},on:{click:function(a){return e.downloadHischeckFile(t.row)}}},[e._v("下载")])]}}])})],1),e._v(" "),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.historyTotal>0,expression:"historyTotal>0"}],attrs:{total:e.historyTotal,page:e.historyObj.pageNum,limit:e.historyObj.pageSize},on:{"update:page":function(t){return e.$set(e.historyObj,"pageNum",t)},"update:limit":function(t){return e.$set(e.historyObj,"pageSize",t)},pagination:e.getHistoryData}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.historyDialog=!1}}},[e._v("取消")])],1)],1)],1)},i=[],s=(a("7514"),a("ac6a"),a("b775")),n="http://10.40.79.18:8005";function r(e){return Object(s["a"])({url:n+"/dm/consistencyCheck/list",method:"get",params:e})}function l(e){return Object(s["a"])({url:n+"/dm/consistencyCheck/save",method:"post",data:e})}function c(e){return Object(s["a"])({url:n+"/dm/database/getDatabaseName",method:"get",params:e})}function d(e){return Object(s["a"])({url:n+"/dm/consistencyCheck/historyList",method:"get",params:e})}function u(e){return Object(s["a"])({url:n+"/dm/consistencyCheck/deleteByIds/"+e,method:"delete"})}function m(e){return Object(s["a"])({url:n+"/dm/consistencyCheck/downloadDfcheckFile",method:"post",data:e,responseType:"arraybuffer"})}function h(e){return Object(s["a"])({url:n+"/dm/consistencyCheck/downHistoryDfcheckFile",method:"post",data:e,responseType:"arraybuffer"})}var p={data:function(){return{exportIcon:"el-icon-download",currentRow:[],loading:!0,queryParams:{pageNum:1,pageSize:10,database_name:""},total:0,tableData:[],msgFormDialog:{databaseId:"",databaseName:""},addDataDialog:!1,databaseNameOptions:[],historyDialog:!1,historyData:[],historyTotal:0,historyObj:{pageNum:1,pageSize:10,id:""},rules:{taskName:[{required:!0,message:"请输入任务名称",trigger:"change"}]}}},created:function(){this.getList(),this.getOptions()},methods:{table_index:function(e){return(this.queryParams.pageNum-1)*this.queryParams.pageSize+e+1},table_index_history:function(e){return(this.historyObj.pageNum-1)*this.historyObj.pageSize+e+1},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},getList:function(){var e=this;this.loading=!0,r(this.queryParams).then((function(t){e.tableData=t.data.pageData,e.total=t.data.totalCount,e.loading=!1}))},handleCurrentChange:function(e){this.currentRow=e},handleExport:function(){var e=this;if(1==this.currentRow.length){this.exportIcon="el-icon-loading";var t={};t.id=this.currentRow[0].databaseId,m(t).then((function(t){e.downloadfileCommon(t),e.exportIcon="el-icon-download"}))}else this.$message({type:"error",message:"请选择一条数据"})},getOptions:function(){var e=this;c().then((function(t){e.databaseNameOptions=t.data}))},getHistoricalReport:function(e){var t=this;this.historyDialog=!0,this.historyObj.id=e.id,this.historyObj.databaseId=e.databaseId,d(this.historyObj).then((function(e){t.historyData=e.data.pageData,t.historyTotal=e.data.totalCount,t.loading=!1}))},downloadHischeckFile:function(e){var t=this,a={};a.file_directory=e.file_directory,a.filename=e.filename,h(a).then((function(e){t.downloadfileCommon(e)}))},addReportData:function(){this.addDataDialog=!0},deleteData:function(){var e=this;if(0!=this.currentRow.length){var t=[];this.currentRow.forEach((function(e){t.push(e.id)})),u(t.join(",")).then((function(t){200==t.code?e.$message({type:"success",message:"删除成功"}):e.$message({type:"error",message:"删除失败"})}))}else this.$message({type:"error",message:"请选择一条数据"})},addReportRecord:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;l(t.msgFormDialog).then((function(e){"200"==e.code?(t.$message({type:"success",message:"添加成功"}),t.$emit("resetQuery"),t.handleQuery(),t.addDataDialog=!1):t.$message({type:"error",message:"添加失败"})}))}))},downloadHistoricalReport:function(){},getHistoryData:function(){},databaseChange:function(e){var t={};t=this.databaseNameOptions.find((function(t){return t.ID===e})),this.msgFormDialog.databaseName=t.DATABASE_NAME}}},g=p,b=a("2877"),f=Object(b["a"])(g,o,i,!1,null,null,null);t["default"]=f.exports},7514:function(e,t,a){"use strict";var o=a("5ca1"),i=a("0a49")(5),s="find",n=!0;s in[]&&Array(1)[s]((function(){n=!1})),o(o.P+o.F*n,"Array",{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),a("9c6c")(s)}}]);