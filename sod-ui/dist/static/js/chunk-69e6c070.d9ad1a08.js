(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-69e6c070","chunk-0c4fbcdc","chunk-6f30afa0"],{"00fa":function(e,t,a){e.exports=a.p+"static/img/h3.42d0f93a.png"},1344:function(e,t,a){e.exports=a.p+"static/img/h5.c2a04329.png"},"2ad3":function(e,t,a){e.exports=a.p+"static/img/h15.ec5226c0.png"},"31b0":function(e,t,a){"use strict";var l=a("9eb9"),r=a.n(l);r.a},3451:function(e,t,a){},"51e5":function(e,t,a){e.exports=a.p+"static/img/h8.c07ce382.png"},"58a2":function(e,t,a){e.exports=a.p+"static/img/h14.d6dfbbee.png"},"658f":function(e,t,a){"use strict";var l=a("b15b"),r=a.n(l);r.a},"6d36":function(e,t,a){e.exports=a.p+"static/img/h12.9bc1d8f2.png"},"6f2b":function(e,t,a){e.exports=a.p+"static/img/h9.ffc51429.png"},"7ac9":function(e,t,a){e.exports=a.p+"static/img/h11.f105f083.png"},"84d7":function(e,t,a){"use strict";a.d(t,"i",(function(){return s})),a.d(t,"g",(function(){return i})),a.d(t,"f",(function(){return o})),a.d(t,"h",(function(){return n})),a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return u})),a.d(t,"c",(function(){return d})),a.d(t,"d",(function(){return m})),a.d(t,"j",(function(){return p})),a.d(t,"e",(function(){return b}));var l=a("b775"),r="http://10.40.79.18:8005";function s(e){return Object(l["a"])({url:r+"/dm/databaseSpecial/page",method:"get",params:e})}function i(e){return Object(l["a"])({url:r+"/dm/databaseSpecial/getById",method:"get",params:e})}function o(e){return Object(l["a"])({url:r+"/dm/databaseSpecial/getAuthorityBySdbId",method:"get",params:e})}function n(e){return Object(l["a"])({url:r+"/dm/databaseSpecial/getSpecialDataList",method:"get",params:e})}function c(e){return Object(l["a"])({url:r+"/dm/databaseSpecial/delete",method:"delete",params:e})}function u(e){return Object(l["a"])({url:r+"/dm/databaseSpecial/empowerDataBatch",method:"post",data:e})}function d(e){return Object(l["a"])({url:r+"/dm/databaseSpecial/empowerDataOne",method:"post",data:e})}function m(e){return Object(l["a"])({url:r+"/dm/databaseSpecial/empowerDatabaseSpecial",method:"post",data:e})}function p(e){return Object(l["a"])({url:r+"/dm/databaseSpecial/save",method:"post",data:e})}function b(e){return Object(l["a"])({url:r+"/dm/fileUpDown/download",method:"get",params:e,responseType:"arraybuffer"})}},"89e9":function(e,t,a){e.exports=a.p+"static/img/h10.a63814ad.png"},9311:function(e,t,a){e.exports=a.p+"static/img/h7.b30eade7.png"},"9eb9":function(e,t,a){},aecf:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"applyTopicDialog"},[a("el-steps",{attrs:{active:e.stepNum,simple:""}},[a("el-step",{attrs:{title:"1 创建专题库"}}),e._v(" "),a("el-step",{attrs:{title:"2 申请资料"}}),e._v(" "),a("el-step",{attrs:{title:"3 提交申请"}})],1),e._v(" "),0===e.stepNum?a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{"font-size":"26px"}},[e._v("创建专题库")]),e._v(" "),a("p",{staticStyle:{"margin-top":"10px","font-size":"14px",color:"#666"}},[e._v("填写专题库申请信息，用于创建专题库。专题库创建后不需要审核，可直接在专题库列表页面查看")])]),e._v(" "),a("div",[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入专题库名称，支持中文，英文，数字和下划线，不超过20个字符"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"简称",prop:"pname"}},[a("el-input",{attrs:{placeholder:"请输入6个字符以内的英文大写"},model:{value:e.ruleForm.pname,callback:function(t){e.$set(e.ruleForm,"pname",t)},expression:"ruleForm.pname"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"数据库",prop:"dbSelect"}},[a("el-checkbox-group",{model:{value:e.ruleForm.dbSelect,callback:function(t){e.$set(e.ruleForm,"dbSelect",t)},expression:"ruleForm.dbSelect"}},e._l(e.ruleForm.database,(function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.name}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"用途",prop:"use"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.use,callback:function(t){e.$set(e.ruleForm,"use",t)},expression:"ruleForm.use"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"图标",prop:"imageURL"}},[e.dialogImageUrl?a("img",{staticStyle:{width:"40px"},attrs:{src:e.dialogImageUrl,alt:""}}):e._e(),e._v(" "),a("el-popover",{attrs:{placement:"right",width:"260",trigger:"click"},model:{value:e.popoverVisibale,callback:function(t){e.popoverVisibale=t},expression:"popoverVisibale"}},[a("div",e._l(e.dialogImageUrlData,(function(t,l){return a("div",{key:l,class:{"demoImage-origin":1==t[1],"is-demoImage-active":0==e.dialogImageUrlData[l][1]},on:{click:function(t){return e.clickImage(l)}}},[a("el-image",{staticStyle:{width:"40px",height:"40px"},attrs:{src:t[0],fit:"fill"}})],1)})),0),e._v(" "),a("el-button",{attrs:{slot:"reference",type:"primary",size:"small"},slot:"reference"},[e._v("选择图标")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"申请材料",prop:"filepath"}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:e.upLoadUrl,limit:1,"on-exceed":e.handleExceed,"file-list":e.filelist,"on-success":e.successUpload}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1),e._v(" "),a("el-button",{staticStyle:{float:"right","margin-top":"-35px"},attrs:{size:"small",type:"primary"},on:{click:e.download}},[e._v("下载模板")])],1)],1)],1)]):e._e(),e._v(" "),1===e.stepNum?a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{"font-size":"26px"}},[e._v("申请资料")]),e._v(" "),a("p",{staticStyle:{"margin-top":"10px","font-size":"14px",color:"#666"}},[e._v("选择需要申请的资料及资料的访问权限")])]),e._v(" "),a("div",[a("el-form",{staticClass:"demo-ruleForm",attrs:{"label-width":"100px"}},[a("el-form-item",{attrs:{label:""}},[a("el-checkbox-group",{model:{value:e.sdbSelect,callback:function(t){e.sdbSelect=t},expression:"sdbSelect"}},e._l(e.ruleForm.database,(function(t){return a("el-checkbox",{key:t.name,attrs:{label:t.id},on:{change:e.getDataByLogic}},[e._v(e._s(t.name))])})),1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-card",{staticClass:"asideTreeScroll"},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[e._v("待选资料")])]),e._v(" "),a("div",{staticClass:"treeBox selScrollBar"},[a("el-tree",{ref:"treeZL",staticClass:"el-tree",attrs:{data:e.treenode,props:e.defaultProps,"auto-expand-parent":"","default-expanded-keys":e.expandedkeys,"default-checked-keys":e.checkedKeys,"node-key":"uid","show-checkbox":""},on:{"check-change":e.changeTree}})],1)])],1),e._v(" "),a("el-col",{attrs:{span:18}},[a("el-card",{staticClass:"asideTable"},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[e._v("已选资料")])]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.deleteMuch}},[e._v("批量删除")]),e._v(" "),a("div",{staticClass:"tableBox selScrollBar"},[a("el-table",{ref:"tableZL",attrs:{data:e.tableData,border:"",stripe:""},on:{"selection-change":e.selectChange}},[a("el-table-column",{attrs:{type:"selection","min-width":"15"}}),e._v(" "),a("el-table-column",{attrs:{type:"index",label:"序号","min-width":"25"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"资料名称","min-width":"60"}}),e._v(" "),a("el-table-column",{attrs:{prop:"d_data_id",label:"四级编码","min-width":"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"table_name",label:"表名称","min-width":"60"}}),e._v(" "),a("el-table-column",{attrs:{prop:"pname",label:"数据库","min-width":"60"}}),e._v(" "),a("el-table-column",{attrs:{prop:"",label:"权限","min-width":"20"},scopedSlots:e._u([{key:"default",fn:function(t){return[""==t.row.readOrWrite?a("span",[e._v("只读")]):e._e()]}}],null,!1,1641864087)}),e._v(" "),a("el-table-column",{attrs:{prop:"",label:"操作","min-width":"20"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.deleteRow(t.$index,e.tableData,t.row.uid)}}},[e._v("删除")])]}}],null,!1,3302233964)})],1)],1)],1)],1)],1)],1)]):e._e(),e._v(" "),2===e.stepNum?a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{"font-size":"26px"}},[e._v("提交申请")]),e._v(" "),a("p",{staticStyle:{"margin-top":"10px","font-size":"14px",color:"#666"}},[e._v("点击申请按钮，提交当前申请信息。点击返回按钮，放弃本次申请操作，并返回到专题库列表页。")])]),e._v(" "),a("div",[a("el-button",{attrs:{type:"primary"},on:{click:e.addSpecialDBApply}},[e._v("提交申请")])],1)]):e._e(),e._v(" "),a("div",{staticClass:"dialog-footer"},[0!=e.stepNum?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.backStep()}}},[e._v("上一步")]):e._e(),e._v(" "),2!=e.stepNum?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.nextStep()}}},[e._v("下一步")]):e._e()],1)],1)},r=[],s=(a("6762"),a("2fdb"),a("7f7f"),a("28a5"),a("ac6a"),{name:"applyTopicDialog",props:{},data:function(){var e=this,t=function(t,a,l){var r=/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/;""==a?l(new Error("请输入专题库名称")):r.test(a)?e.axios.get(interfaceObj.SpecialDB_validNameOrCode+"name="+a).then((function(e){e.data&&0==e.data.returnCode?l():l(new Error("专题库名称已经存在"))})):l(new Error("专题库名称允许中文，英文，数字，下划线，且不能以下划线开始"))},l=function(t,a,l){var r=/^[A-Z]+$/;if(""==a)l(new Error("请输入专题库简称"));else{if(!r.test(a))return l(new Error("专题库简称只能是大写英文"));e.axios.get(interfaceObj.SpecialDB_validNameOrCode+"code="+a).then((function(e){e.data&&0==e.data.returnCode?l():l(new Error("专题库简称已经存在"))}))}};return{currentNodeArry:[],checkedKeys:[],expandedkeys:[],upLoadUrl:"",stepNum:0,ruleForm:{name:"",pname:"",use:"",imageURL:"",database:[],dbSelect:[],filepath:"",tableData:[]},filelist:[],sdbSelect:[],dialogImageUrl:"",popoverVisibale:!1,dialogImageUrlData:[[a("dde0"),1],[a("afa1"),1],[a("00fa"),1],[a("d4c8"),1],[a("1344"),1],[a("d0e7"),1],[a("9311"),1],[a("51e5"),1],[a("6f2b"),1],[a("89e9"),1],[a("7ac9"),1],[a("6d36"),1],[a("ba76"),1],[a("58a2"),1],[a("2ad3"),1]],treenode:[],tableData:[],defaultProps:{children:"children",label:"name"},tableSelsectData:[],rules:{name:[{min:1,max:20,message:"不超过20个字符",trigger:"blur"},{required:!0,validator:t,trigger:"blur"}],pname:[{min:1,max:6,message:"输入长度不能大于6个字符",trigger:"blur"},{required:!0,validator:l,trigger:"blur"}],dbSelect:[{type:"array",required:!0,message:"请选择数据库",trigger:"change"}],use:[{required:!0,message:"请填写专题库用途",trigger:"blur"},{min:0,max:100,message:"输入长度不能大于100个字符",trigger:"blur"}],imageURL:[{required:!0,message:"请选择图标",trigger:"change"}],filepath:[{required:!0,message:"请上传文件",trigger:"change"}]}}},created:function(){},methods:{selectChange:function(e){this.tableSelsectData=e},clickImage:function(e){this.dialogImageUrlData.forEach((function(e,t,a){e[1]=1})),this.dialogImageUrlData[e][1]=0;var t="/assets/images/icon/h"+(e+1)+".png";this.dialogImageUrl=this.dialogImageUrlData[e][0],this.popoverVisibale=!1,this.ruleForm.imageURL=t},successUpload:function(e,t,a){this.ruleForm.filepath=t.raw},backStep:function(){0!=this.stepNum&&(this.stepNum=this.stepNum-1)},nextStep:function(){var e=this;if(0==this.stepNum&&this.$refs["ruleForm"].validate((function(t){if(!t)return!1;e.stepNum=e.stepNum+1})),1==this.stepNum){var t=this.$refs.treeZL.getCheckedNodes(!0);t.forEach((function(t,a,l){e.ruleForm.tableData.push({DATA_CLASS_ID:t.id,LOGIC_ID:t.physicalDB.split(",")[0],APPLY_AUTHORITY:"1"})})),this.stepNum=this.stepNum+1}},getDatabase:function(){var e=this;this.axios.get(interfaceObj.SpecialDB_getPhysicDB).then((function(t){e.ruleForm.database=t.data.DS,console.log(e.ruleForm.database)}))},getDataByLogic:function(){var e=this,t=this.$refs.treeZL.getCheckedNodes(!0);t.forEach((function(t){e.currentNodeArry.push(t.uid)}));var a="",l=this;this.sdbSelect.forEach((function(e,t,l){a=a+"&logics="+e})),this.axios.get(interfaceObj.SpecialDB_getDataByLogics+a).then((function(t){var a=t.data.data,r=[],s={};a.forEach((function(e,t,a){var i=e["pId"],o=e["id"];if("-1"==i)s[o]=[r.length],e.children=[],r.push(e);else if(s[i]){var n=s[i][0];e.pname=l.setPhysicalName(e.physicalDB),r[n].children.push(e)}})),e.treenode=r,e.checkedKeys=e.currentNodeArry}))},setPhysicalName:function(e){if(e){var t=e.split(",")[0],a="";return this.ruleForm.database.forEach((function(e,l,r){e.id==t&&(a=e.name)})),a}},changeTree:function(e){this.tableData=this.$refs.treeZL.getCheckedNodes(!0)},deleteRow:function(e,t,a){this.$refs.treeZL.setChecked(a,!1),t.splice(e,1)},deleteMuch:function(){var e=this;this.tableSelsectData.length>0?this.$confirm("确定选中数据都删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.tableSelsectData.forEach((function(t,a,l){e.$refs.treeZL.setChecked(t.uid,!1)})),e.tableData=e.tableData.filter((function(t){return!e.tableSelsectData.includes(t)})),console.log(e.tableData)})):this.$message.error("请选择需要删除的文件！")},download:function(){var e=interfaceObj.demoWordUrl+"专题库申请表模板.docx";this.axios.get(interfaceObj.download+"?filepath="+e).then((function(t){testExport(interfaceObj.download+"?filepath="+e)})).catch((function(t){testExport(interfaceObj.download+"?filepath="+e)}))},handleExceed:function(){this.$message.warning("当前限制选择1个文件")},addSpecialDBApply:function(){var e=this,t=new FormData;t.append("TDB_NAME",this.ruleForm.name),t.append("SCHEMA_ID",this.ruleForm.pname),t.append("USES",this.ruleForm.use),t.append("TDB_IMG",this.ruleForm.imageURL);var a=[];this.ruleForm.database.forEach((function(t){e.ruleForm.dbSelect.forEach((function(e){t.name==e&&a.push(t.id)}))})),t.append("DATABASE_ID",a.join(",")),t.append("APPLY_FILE_PATH",this.ruleForm.filepath),t.append("TABLE_DATA",JSON.stringify(this.ruleForm.tableData));var l=this.$store.getters.getLoginUser.userId;this.axios.post(interfaceObj.SpecialDB_addSpecialDBApply+l,t).then((function(t){0==t.data.returnCode?(e.$message({showClose:!0,message:"保存成功，请等待管理员审核",type:"success"}),e.$emit("closedialog")):e.$message.error("申请失败，请联管理员")}))}}}),i=s,o=(a("da1d"),a("2877")),n=Object(o["a"])(i,l,r,!1,null,null,null);t["default"]=n.exports},afa1:function(e,t,a){e.exports=a.p+"static/img/h2.ab690d33.png"},afdb:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-form",{ref:"queryForm",staticClass:"searchBox",attrs:{model:e.queryParams,inline:!0}},[a("el-form-item",{attrs:{label:"资料状态"}},[a("el-select",{model:{value:e.queryParams.examineStatus,callback:function(t){e.$set(e.queryParams,"examineStatus",t)},expression:"queryParams.examineStatus"}},[a("el-option",{attrs:{label:"全部",value:""}}),e._v(" "),e._l(e.auditStatus,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],2)],1),e._v(" "),a("el-form-item",{attrs:{label:"专题库名称"}},[a("el-input",{attrs:{type:"text",placeholder:"专题库名称"},model:{value:e.queryParams.sdbName,callback:function(t){e.$set(e.queryParams,"sdbName",t)},expression:"queryParams.sdbName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"申请用户"}},[a("el-input",{attrs:{type:"text",placeholder:"申请用户"},model:{value:e.queryParams.userName,callback:function(t){e.$set(e.queryParams,"userName",t)},expression:"queryParams.userName"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-search"},on:{click:e.handleQuery}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{size:"small",icon:"el-icon-refresh-right"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,"row-key":"id"},on:{"sort-change":e.sortChange}},[a("el-table-column",{attrs:{type:"index",width:"50",index:e.table_index}}),e._v(" "),a("el-table-column",{attrs:{prop:"sdbName",label:"专题名","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"databaseSchema",label:"专题库简称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"userName",label:"用户名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"department",label:"部门"}}),e._v(" "),a("el-table-column",{attrs:{prop:"userPhone",label:"联系方式"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"申请时间",width:"160px",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.parseTime(t.row.createTime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"serverStatus",label:"用途",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popover",{attrs:{placement:"top",effect:"dark",trigger:"hover",width:"200","popper-class":"darkPopover"}},[a("p",[e._v(e._s(t.row.uses))]),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-link",{attrs:{underline:!1}},[e._v("查看用途")])],1)])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"examineStatus",label:"资料状态",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.examineStatus?a("span",[e._v("待审核")]):e._e(),e._v(" "),"2"==t.row.examineStatus?a("span",[e._v("审核通过")]):e._e(),e._v(" "),"3"==t.row.examineStatus?a("span",[e._v("审核不通过")]):e._e(),e._v(" "),"4"==t.row.examineStatus?a("span",[e._v("再次审核")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"160px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit"},on:{click:function(a){return e.editCell(t.row)}}},[e._v("修改权限")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(a){return e.deleteCell(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}}),e._v(" "),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"专题库资料授权查看",visible:e.handleDialog,width:"1200px"},on:{"update:visible":function(t){e.handleDialog=t}}},[e.handleDialog?a("handleLibrary",{ref:"myHandleServer",attrs:{handleObj:e.handleObj},on:{closedialog:e.closeeditDialog}}):e._e()],1),e._v(" "),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"专题库创建",visible:e.applyTopicDialog,width:"1200px",top:"5vh"},on:{"update:visible":function(t){e.applyTopicDialog=t}}},[e.applyTopicDialog?a("applyTopic",{ref:"applyTopicServer",on:{closedialog:e.closeeditDialog}}):e._e()],1)],1)},r=[],s=a("84d7"),i=a("c559"),o=a("aecf"),n={components:{handleLibrary:i["default"],applyTopic:o["default"]},data:function(){return{loading:!0,queryParams:{pageNum:1,pageSize:10,examineStatus:"",sdbName:"",userName:"",params:{orderBy:{createTime:"desc"}}},auditStatus:[{value:"1",label:"待审核"},{value:"2",label:"已审核"},{value:"3",label:"审核不通过"},{value:"4",label:"再次审核"}],total:0,tableData:[],dialogTitle:"",handleDialog:!1,applyTopicDialog:!1}},created:function(){this.getList()},methods:{sortChange:function(e,t,a){var l={};"ascending"==e.order?l.createTime="asc":l.createTime="desc",this.queryParams.params.orderBy=l,this.handleQuery()},table_index:function(e){return(this.queryParams.pageNum-1)*this.queryParams.pageSize+e+1},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},getList:function(){var e=this;this.loading=!0,console.log(this.queryParams),Object(s["i"])(this.queryParams).then((function(t){e.tableData=t.data.pageData,e.total=t.data.totalCount,e.loading=!1}))},resetQuery:function(){this.queryParams={pageNum:1,pageSize:10,examineStatus:"",sdbName:"",userName:""},this.handleQuery()},deleteCell:function(e){var t=this;Object(s["a"])({id:e.id}).then((function(e){200==e.code?(t.$message({type:"success",message:"删除成功"}),t.resetQuery()):t.$message({type:"error",message:e.msg})}))},editCell:function(e){this.handleObj=e,this.handleDialog=!0},closeeditDialog:function(){this.handleObj={},this.handleDialog=!1,this.applyTopicDialog=!1,this.handleQuery()}}},c=n,u=(a("658f"),a("2877")),d=Object(u["a"])(c,l,r,!1,null,"00ed1366",null);t["default"]=d.exports},b15b:function(e,t,a){},ba76:function(e,t,a){e.exports=a.p+"static/img/h13.c347a4c2.png"},c559:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"handleLiberyDialog"},[a("el-tabs",{attrs:{type:"border-card"}},[a("el-tab-pane",{attrs:{label:"基本信息"}},[a("el-form",{ref:"ruleForm",attrs:{model:e.msgFormDialog,"label-width":"100px"}},[e.handleObj.pageName?e._e():a("el-form-item",{attrs:{label:"图标"}},[e.sdbImg?a("img",{staticStyle:{width:"40px"},attrs:{src:e.sdbImg,alt:""}}):e._e()]),e._v(" "),a("el-form-item",{attrs:{label:"专题库名称"}},[a("el-input",{attrs:{size:"small"},model:{value:e.msgFormDialog.sdbName,callback:function(t){e.$set(e.msgFormDialog,"sdbName",t)},expression:"msgFormDialog.sdbName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"用途"}},[a("el-input",{attrs:{size:"small"},model:{value:e.msgFormDialog.uses,callback:function(t){e.$set(e.msgFormDialog,"uses",t)},expression:"msgFormDialog.uses"}})],1),e._v(" "),e.handleObj.pageName?e._e():a("el-form-item",{attrs:{label:"创建人"}},[a("el-input",{attrs:{size:"small",disabled:!0},model:{value:e.msgFormDialog.userId,callback:function(t){e.$set(e.msgFormDialog,"userId",t)},expression:"msgFormDialog.userId"}})],1),e._v(" "),e.handleObj.pageName?e._e():a("el-form-item",{attrs:{label:"机构"}},[a("el-input",{attrs:{size:"small",disabled:!0},model:{value:e.msgFormDialog.department,callback:function(t){e.$set(e.msgFormDialog,"department",t)},expression:"msgFormDialog.department"}})],1),e._v(" "),e.handleObj.pageName?e._e():a("el-form-item",{attrs:{label:"联系方式"}},[a("el-input",{attrs:{size:"small",disabled:!0},model:{value:e.msgFormDialog.phoneNum,callback:function(t){e.$set(e.msgFormDialog,"phoneNum",t)},expression:"msgFormDialog.phoneNum"}})],1),e._v(" "),e.handleObj.pageName?e._e():a("el-form-item",{attrs:{label:"申请材料"}},[a("el-button",{attrs:{disabled:!e.msgFormDialog.applyMaterial,size:"small",type:"success",icon:"el-icon-document"},on:{click:e.handleExport}},[e._v("下载")])],1),e._v(" "),a("el-form-item",{attrs:{label:"排序"}},[a("el-input",{attrs:{size:"small"},model:{value:e.msgFormDialog.sortNo,callback:function(t){e.$set(e.msgFormDialog,"sortNo",t)},expression:"msgFormDialog.sortNo"}})],1),e._v(" "),a("div",{staticClass:"dialog-footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.trueDialog("ruleForm")}}},[e._v("保 存")])],1)],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"数据库授权"}},[a("el-form",[a("el-row",{staticClass:"center"},[a("el-col",{attrs:{span:24}},[a("span",{staticStyle:{"font-weight":"bold"}},[e._v(e._s(this.msgFormDialog.sdbName))])])],1),e._v(" "),a("el-row",{staticClass:"center"},[a("el-col",{attrs:{span:24}},[a("span",[e._v("专题库英文简称:")]),e._v(" "),a("span",[e._v(e._s(this.msgFormDialog.simpleName))])])],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.databaseList,border:"",stripe:""}},[a("el-table-column",{attrs:{prop:"databaseId",label:"数据库"}}),e._v(" "),a("el-table-column",{attrs:{label:"权限"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox-group",{model:{value:t.row.checkList,callback:function(a){e.$set(t.row,"checkList",a)},expression:"scope.row.checkList"}},[a("el-checkbox",{attrs:{label:"createTable"}},[e._v("创建")]),e._v(" "),a("el-checkbox",{attrs:{label:"deleteTable"}},[e._v("删除")]),e._v(" "),a("el-checkbox",{attrs:{label:"tableDataAccess"}},[e._v("读写")])],1)]}}])})],1),e._v(" "),a("el-row",[a("el-col",{staticStyle:{"text-align":"center","margin-top":"10px"}},[a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-thumb"},on:{click:e.addPhysicsDefine}},[e._v("数据库授权")])],1)],1)],1)],1),e._v(" "),e.handleObj.pageName?e._e():a("el-tab-pane",{attrs:{label:"专题库资料"}},[a("section",{staticClass:"searchCon"},[a("el-form",{ref:"modelForm",staticClass:"funLoad selSearchCon",attrs:{inline:!0,model:e.searchLibraryObj}},[a("el-form-item",{attrs:{label:"关键字查询"}},[a("el-select",{attrs:{size:"small"},model:{value:e.searchLibraryObj.key,callback:function(t){e.$set(e.searchLibraryObj,"key",t)},expression:"searchLibraryObj.key"}},[a("el-option",{attrs:{label:"资料分类",value:"typeName"}}),e._v(" "),a("el-option",{attrs:{label:"资料名称",value:"dataName"}}),e._v(" "),a("el-option",{attrs:{label:"表名称",value:"tableName"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-input",{attrs:{size:"small",type:"text"},model:{value:e.searchLibraryObj.valueText,callback:function(t){e.$set(e.searchLibraryObj,"valueText",t)},expression:"searchLibraryObj.valueText"}})],1),e._v(" "),a("el-form-item",{staticClass:"handleSearchBtn"},[a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-search"},on:{click:e.searchLibraryFun}},[e._v("查询")])],1)],1)],1),e._v(" "),a("section",{staticClass:"loadTable"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableLibraryData,border:""}},[a("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"typeName",label:"资料分类","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"dataName",label:"资料名称","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"ddataId",label:"四级编码","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"tableName",label:"表名称","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"databaseName",label:"数据库","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"applyAuthority",label:"申请权限",width:"80",formatter:e.applyAuthFormatter}})],1)],1)]),e._v(" "),e.handleObj.pageName?e._e():a("el-tab-pane",{attrs:{label:"基础库资料"}},[a("section",{staticClass:"searchCon"},[a("el-form",{ref:"modelForm",staticClass:"funLoad selSearchCon",attrs:{inline:!0,model:e.searchBaseLibraryObj}},[a("el-form-item",{attrs:{label:"关键字查询"}},[a("el-select",{attrs:{size:"small"},model:{value:e.searchBaseLibraryObj.key,callback:function(t){e.$set(e.searchBaseLibraryObj,"key",t)},expression:"searchBaseLibraryObj.key"}},[a("el-option",{attrs:{label:"资料分类",value:"typeName"}}),e._v(" "),a("el-option",{attrs:{label:"资料名称",value:"dataName"}}),e._v(" "),a("el-option",{attrs:{label:"表名称",value:"tableName"}}),e._v(" "),a("el-option",{attrs:{label:"申请权限",value:"applyAuthority"}}),e._v(" "),a("el-option",{attrs:{label:"审核状态",value:"empowerAuthority"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-input",{attrs:{size:"small",type:"text"},model:{value:e.searchBaseLibraryObj.valueText,callback:function(t){e.$set(e.searchBaseLibraryObj,"valueText",t)},expression:"searchBaseLibraryObj.valueText"}})],1),e._v(" "),a("el-form-item",{staticClass:"handleSearchBtn"},[a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-search"},on:{click:e.loadReadList}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-thumb"},on:{click:function(t){return e.batchUpdatePower("1")}}},[e._v("授权")]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"small",icon:"el-icon-close"},on:{click:function(t){return e.batchUpdatePower("2")}}},[e._v("拒绝")])],1)],1)],1),e._v(" "),a("section",{staticClass:"loadTable"},[a("el-table",{attrs:{data:e.baseTableLibraryData,border:""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),a("el-table-column",{attrs:{prop:"typeName",label:"资料分类","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"dataName",label:"资料名称","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"ddataId",label:"四级编码","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"tableName",label:"表名称","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"databaseName",label:"数据库","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{prop:"applyAuthority",width:"80px",label:"申请权限",formatter:e.applyAuthFormatter}}),e._v(" "),a("el-table-column",{attrs:{prop:"empowerAuthority",label:"审核状态"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.empowerAuthority?a("el-link",{attrs:{underline:!1,size:"small",type:"success",icon:"el-icon-check"}},[e._v("已授权")]):a("el-link",{attrs:{underline:!1,size:"small",type:"danger",icon:"el-icon-close"}},[e._v("已撤销")])]}}],null,!1,2569904908)}),e._v(" "),a("el-table-column",{attrs:{prop:"examine_status",label:"备注"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[e._v(e._s(t.row.failureReason))]),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"medium"}},[e._v("查看")])],1)])]}}],null,!1,3453803811)}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"240px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{plain:"",type:"primary",size:"mini",icon:"el-icon-thumb"},on:{click:function(a){return e.updatePower(t.row,"1")}}},[e._v("授权")]),e._v(" "),a("el-button",{attrs:{plain:"",type:"danger",size:"mini",icon:"el-icon-close"},on:{click:function(a){return e.updatePower(t.row,"2")}}},[e._v("拒绝")])]}}],null,!1,1638602640)})],1)],1)])],1)],1)},r=[],s=(a("ac6a"),a("84d7")),i=(a("e09d"),{name:"handleLiberyDialog",props:{handleObj:{type:Object}},data:function(){return{msgFormDialog:{},searchLibraryObj:{key:"typeName",valueText:""},searchBaseLibraryObj:{key:"typeName",valueText:""},baseTableLibraryData:[],tableLibraryData:[],databaseList:[],multipleSelection:[],paramList:[],refuseReasonDialog:!1,refusereason:"",single:!1,sdbImg:"",dialogImageUrlData:[a("dde0"),a("afa1"),a("00fa"),a("d4c8"),a("1344"),a("d0e7"),a("9311"),a("51e5"),a("6f2b"),a("89e9"),a("7ac9"),a("6d36"),a("ba76"),a("58a2"),a("2ad3")]}},created:function(){this.handleObj.id&&(console.log(this.handleObj),this.initDetail()),this.searchLibraryFun(),this.loadReadList()},methods:{applyAuthFormatter:function(e,t){return"1"==e.applyAuthority?"只读":"2"==e.applyAuthority?"读写":void 0},handleExport:function(){var e=this;Object(s["e"])({filePath:this.msgFormDialog.applyMaterial}).then((function(t){t.code?e.$message({type:"warning",message:t.msg}):e.downloadfileCommon(t)}))},initDetail:function(){var e=this;Object(s["g"])({id:this.handleObj.id}).then((function(t){200==t.code&&(e.msgFormDialog=t.data,e.msgFormDialog.applyMaterial||e.handleObj.pageName||e.$message({type:"danger",message:"文件不存在"}))})),Object(s["f"])({sdbId:this.handleObj.id}).then((function(t){200==t.code&&t.data&&t.data.length>0&&(e.databaseList=t.data,e.databaseList.forEach((function(t,a){e.$set(t,"checkList",[]),"2"==t.createTable&&t.checkList.push("createTable"),"2"==t.deleteTable&&t.checkList.push("deleteTable"),"2"==t.tableDataAccess&&t.checkList.push("tableDataAccess")})))}))},trueDialog:function(){var e=this;Object(s["j"])(this.msgFormDialog).then((function(t){200==t.code?(e.$emit("closedialog"),e.$message({type:"success",message:"保存成功"})):e.$message({type:"error",message:t.msg})}))},searchLibraryFun:function(){var e=this,t={dataType:1,sdbId:this.handleObj.id};this.searchLibraryObj.valueText&&(t[this.searchLibraryObj.key]=this.searchLibraryObj.valueText),console.log(t),Object(s["h"])(t).then((function(t){e.tableLibraryData=t.data}))},loadReadList:function(){var e=this,t={dataType:2,sdbId:this.handleObj.id};this.searchBaseLibraryObj.valueText&&(t[this.searchBaseLibraryObj.key]=this.searchBaseLibraryObj.valueText),console.log(t),Object(s["h"])(t).then((function(t){e.baseTableLibraryData=t.data}))},addPhysicsDefine:function(){var e=this,t={},a=this.databaseList;a.forEach((function(e){var t=e.checkList;t.forEach((function(t){e[t]&&(e[t]=2)}))})),t.databaseSpecialAuthorityList=a,t.databaseId=this.msgFormDialog.databaseId,t.sdbId=this.msgFormDialog.id,t.sdbName=this.msgFormDialog.sdbName,t.simpleName=this.msgFormDialog.simpleName,t.userId=this.msgFormDialog.userId,console.log(t),Object(s["d"])(t).then((function(t){200==t.code&&(e.$message({type:"success",message:"授权成功"}),e.databaseList=[],e.initDetail(),e.searchLibraryFun(),e.loadReadList())}))},handleSelectionChange:function(e){this.multipleSelection=e},updatePower:function(e,t){var a=this;e.examineStatus=t,"2"==t?this.$prompt("请输入拒绝原因","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(t){var l=t.value;e.failureReason=l,a.editPowerOne(e)})).catch((function(){})):this.editPowerOne(e)},editPowerOne:function(e){var t=this;console.log(e),Object(s["c"])(e).then((function(e){200==e.code?(t.$message({type:"success",message:"授权成功"}),t.loadReadList()):t.$message({type:"error",message:"授权失败"})}))},batchUpdatePower:function(e){var t=this;this.multipleSelection.length>0?"2"==e?this.$prompt("请输入拒绝原因","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(e){var a=e.value;t.multipleSelection.forEach((function(e){e.failureReason=a,e.examineStatus=2})),t.editPowerBath()})).catch((function(){})):(this.multipleSelection.forEach((function(e){e.examineStatus=1})),this.editPowerBath()):this.$message({type:"warning",message:"请勾选需要操作的资料"})},editPowerBath:function(){var e=this;console.log(this.multipleSelection),Object(s["b"])(this.multipleSelection).then((function(t){200==t.code?(e.$message({type:"success",message:"授权成功"}),e.loadReadList()):e.$message({type:"error",message:"授权失败"})}))}}}),o=i,n=(a("31b0"),a("2877")),c=Object(n["a"])(o,l,r,!1,null,null,null);t["default"]=c.exports},d0e7:function(e,t,a){e.exports=a.p+"static/img/h6.622ca2de.png"},d4c8:function(e,t,a){e.exports=a.p+"static/img/h4.f54d5416.png"},da1d:function(e,t,a){"use strict";var l=a("3451"),r=a.n(l);r.a},dde0:function(e,t,a){e.exports=a.p+"static/img/h1.1bc196c8.png"},e09d:function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"a",(function(){return i}));var l=a("b775"),r="http://10.40.79.18:8005";function s(e){return Object(l["a"])({url:r+"/system/user/gatAllBiz",method:"get",params:e})}function i(e){return Object(l["a"])({url:r+"/dm/databaseSpecial/findByUserId",method:"get",params:e})}}}]);