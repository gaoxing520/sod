(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6f30afa0"],{"00fa":function(e,t,a){e.exports=a.p+"static/img/h3.42d0f93a.png"},1344:function(e,t,a){e.exports=a.p+"static/img/h5.c2a04329.png"},"2ad3":function(e,t,a){e.exports=a.p+"static/img/h15.ec5226c0.png"},3451:function(e,t,a){},"51e5":function(e,t,a){e.exports=a.p+"static/img/h8.c07ce382.png"},"58a2":function(e,t,a){e.exports=a.p+"static/img/h14.d6dfbbee.png"},"6d36":function(e,t,a){e.exports=a.p+"static/img/h12.9bc1d8f2.png"},"6f2b":function(e,t,a){e.exports=a.p+"static/img/h9.ffc51429.png"},"7ac9":function(e,t,a){e.exports=a.p+"static/img/h11.f105f083.png"},"89e9":function(e,t,a){e.exports=a.p+"static/img/h10.a63814ad.png"},9311:function(e,t,a){e.exports=a.p+"static/img/h7.b30eade7.png"},aecf:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"applyTopicDialog"},[a("el-steps",{attrs:{active:e.stepNum,simple:""}},[a("el-step",{attrs:{title:"1 创建专题库"}}),e._v(" "),a("el-step",{attrs:{title:"2 申请资料"}}),e._v(" "),a("el-step",{attrs:{title:"3 提交申请"}})],1),e._v(" "),0===e.stepNum?a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{"font-size":"26px"}},[e._v("创建专题库")]),e._v(" "),a("p",{staticStyle:{"margin-top":"10px","font-size":"14px",color:"#666"}},[e._v("填写专题库申请信息，用于创建专题库。专题库创建后不需要审核，可直接在专题库列表页面查看")])]),e._v(" "),a("div",[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入专题库名称，支持中文，英文，数字和下划线，不超过20个字符"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"简称",prop:"pname"}},[a("el-input",{attrs:{placeholder:"请输入6个字符以内的英文大写"},model:{value:e.ruleForm.pname,callback:function(t){e.$set(e.ruleForm,"pname",t)},expression:"ruleForm.pname"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"数据库",prop:"dbSelect"}},[a("el-checkbox-group",{model:{value:e.ruleForm.dbSelect,callback:function(t){e.$set(e.ruleForm,"dbSelect",t)},expression:"ruleForm.dbSelect"}},e._l(e.ruleForm.database,(function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.name}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"用途",prop:"use"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.use,callback:function(t){e.$set(e.ruleForm,"use",t)},expression:"ruleForm.use"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"图标",prop:"imageURL"}},[e.dialogImageUrl?a("img",{staticStyle:{width:"40px"},attrs:{src:e.dialogImageUrl,alt:""}}):e._e(),e._v(" "),a("el-popover",{attrs:{placement:"right",width:"260",trigger:"click"},model:{value:e.popoverVisibale,callback:function(t){e.popoverVisibale=t},expression:"popoverVisibale"}},[a("div",e._l(e.dialogImageUrlData,(function(t,r){return a("div",{key:r,class:{"demoImage-origin":1==t[1],"is-demoImage-active":0==e.dialogImageUrlData[r][1]},on:{click:function(t){return e.clickImage(r)}}},[a("el-image",{staticStyle:{width:"40px",height:"40px"},attrs:{src:t[0],fit:"fill"}})],1)})),0),e._v(" "),a("el-button",{attrs:{slot:"reference",type:"primary",size:"small"},slot:"reference"},[e._v("选择图标")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"申请材料",prop:"filepath"}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:e.upLoadUrl,limit:1,"on-exceed":e.handleExceed,"file-list":e.filelist,"on-success":e.successUpload}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1),e._v(" "),a("el-button",{staticStyle:{float:"right","margin-top":"-35px"},attrs:{size:"small",type:"primary"},on:{click:e.download}},[e._v("下载模板")])],1)],1)],1)]):e._e(),e._v(" "),1===e.stepNum?a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{"font-size":"26px"}},[e._v("申请资料")]),e._v(" "),a("p",{staticStyle:{"margin-top":"10px","font-size":"14px",color:"#666"}},[e._v("选择需要申请的资料及资料的访问权限")])]),e._v(" "),a("div",[a("el-form",{staticClass:"demo-ruleForm",attrs:{"label-width":"100px"}},[a("el-form-item",{attrs:{label:""}},[a("el-checkbox-group",{model:{value:e.sdbSelect,callback:function(t){e.sdbSelect=t},expression:"sdbSelect"}},e._l(e.ruleForm.database,(function(t){return a("el-checkbox",{key:t.name,attrs:{label:t.id},on:{change:e.getDataByLogic}},[e._v(e._s(t.name))])})),1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-card",{staticClass:"asideTreeScroll"},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[e._v("待选资料")])]),e._v(" "),a("div",{staticClass:"treeBox selScrollBar"},[a("el-tree",{ref:"treeZL",staticClass:"el-tree",attrs:{data:e.treenode,props:e.defaultProps,"auto-expand-parent":"","default-expanded-keys":e.expandedkeys,"default-checked-keys":e.checkedKeys,"node-key":"uid","show-checkbox":""},on:{"check-change":e.changeTree}})],1)])],1),e._v(" "),a("el-col",{attrs:{span:18}},[a("el-card",{staticClass:"asideTable"},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[e._v("已选资料")])]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.deleteMuch}},[e._v("批量删除")]),e._v(" "),a("div",{staticClass:"tableBox selScrollBar"},[a("el-table",{ref:"tableZL",attrs:{data:e.tableData,border:"",stripe:""},on:{"selection-change":e.selectChange}},[a("el-table-column",{attrs:{type:"selection","min-width":"15"}}),e._v(" "),a("el-table-column",{attrs:{type:"index",label:"序号","min-width":"25"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"资料名称","min-width":"60"}}),e._v(" "),a("el-table-column",{attrs:{prop:"d_data_id",label:"四级编码","min-width":"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"table_name",label:"表名称","min-width":"60"}}),e._v(" "),a("el-table-column",{attrs:{prop:"pname",label:"数据库","min-width":"60"}}),e._v(" "),a("el-table-column",{attrs:{prop:"",label:"权限","min-width":"20"},scopedSlots:e._u([{key:"default",fn:function(t){return[""==t.row.readOrWrite?a("span",[e._v("只读")]):e._e()]}}],null,!1,1641864087)}),e._v(" "),a("el-table-column",{attrs:{prop:"",label:"操作","min-width":"20"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.deleteRow(t.$index,e.tableData,t.row.uid)}}},[e._v("删除")])]}}],null,!1,3302233964)})],1)],1)],1)],1)],1)],1)]):e._e(),e._v(" "),2===e.stepNum?a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{"font-size":"26px"}},[e._v("提交申请")]),e._v(" "),a("p",{staticStyle:{"margin-top":"10px","font-size":"14px",color:"#666"}},[e._v("点击申请按钮，提交当前申请信息。点击返回按钮，放弃本次申请操作，并返回到专题库列表页。")])]),e._v(" "),a("div",[a("el-button",{attrs:{type:"primary"},on:{click:e.addSpecialDBApply}},[e._v("提交申请")])],1)]):e._e(),e._v(" "),a("div",{staticClass:"dialog-footer"},[0!=e.stepNum?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.backStep()}}},[e._v("上一步")]):e._e(),e._v(" "),2!=e.stepNum?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.nextStep()}}},[e._v("下一步")]):e._e()],1)],1)},i=[],l=(a("6762"),a("2fdb"),a("7f7f"),a("28a5"),a("ac6a"),{name:"applyTopicDialog",props:{},data:function(){var e=this,t=function(t,a,r){var i=/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/;""==a?r(new Error("请输入专题库名称")):i.test(a)?e.axios.get(interfaceObj.SpecialDB_validNameOrCode+"name="+a).then((function(e){e.data&&0==e.data.returnCode?r():r(new Error("专题库名称已经存在"))})):r(new Error("专题库名称允许中文，英文，数字，下划线，且不能以下划线开始"))},r=function(t,a,r){var i=/^[A-Z]+$/;if(""==a)r(new Error("请输入专题库简称"));else{if(!i.test(a))return r(new Error("专题库简称只能是大写英文"));e.axios.get(interfaceObj.SpecialDB_validNameOrCode+"code="+a).then((function(e){e.data&&0==e.data.returnCode?r():r(new Error("专题库简称已经存在"))}))}};return{currentNodeArry:[],checkedKeys:[],expandedkeys:[],upLoadUrl:"",stepNum:0,ruleForm:{name:"",pname:"",use:"",imageURL:"",database:[],dbSelect:[],filepath:"",tableData:[]},filelist:[],sdbSelect:[],dialogImageUrl:"",popoverVisibale:!1,dialogImageUrlData:[[a("dde0"),1],[a("afa1"),1],[a("00fa"),1],[a("d4c8"),1],[a("1344"),1],[a("d0e7"),1],[a("9311"),1],[a("51e5"),1],[a("6f2b"),1],[a("89e9"),1],[a("7ac9"),1],[a("6d36"),1],[a("ba76"),1],[a("58a2"),1],[a("2ad3"),1]],treenode:[],tableData:[],defaultProps:{children:"children",label:"name"},tableSelsectData:[],rules:{name:[{min:1,max:20,message:"不超过20个字符",trigger:"blur"},{required:!0,validator:t,trigger:"blur"}],pname:[{min:1,max:6,message:"输入长度不能大于6个字符",trigger:"blur"},{required:!0,validator:r,trigger:"blur"}],dbSelect:[{type:"array",required:!0,message:"请选择数据库",trigger:"change"}],use:[{required:!0,message:"请填写专题库用途",trigger:"blur"},{min:0,max:100,message:"输入长度不能大于100个字符",trigger:"blur"}],imageURL:[{required:!0,message:"请选择图标",trigger:"change"}],filepath:[{required:!0,message:"请上传文件",trigger:"change"}]}}},created:function(){},methods:{selectChange:function(e){this.tableSelsectData=e},clickImage:function(e){this.dialogImageUrlData.forEach((function(e,t,a){e[1]=1})),this.dialogImageUrlData[e][1]=0;var t="/assets/images/icon/h"+(e+1)+".png";this.dialogImageUrl=this.dialogImageUrlData[e][0],this.popoverVisibale=!1,this.ruleForm.imageURL=t},successUpload:function(e,t,a){this.ruleForm.filepath=t.raw},backStep:function(){0!=this.stepNum&&(this.stepNum=this.stepNum-1)},nextStep:function(){var e=this;if(0==this.stepNum&&this.$refs["ruleForm"].validate((function(t){if(!t)return!1;e.stepNum=e.stepNum+1})),1==this.stepNum){var t=this.$refs.treeZL.getCheckedNodes(!0);t.forEach((function(t,a,r){e.ruleForm.tableData.push({DATA_CLASS_ID:t.id,LOGIC_ID:t.physicalDB.split(",")[0],APPLY_AUTHORITY:"1"})})),this.stepNum=this.stepNum+1}},getDatabase:function(){var e=this;this.axios.get(interfaceObj.SpecialDB_getPhysicDB).then((function(t){e.ruleForm.database=t.data.DS,console.log(e.ruleForm.database)}))},getDataByLogic:function(){var e=this,t=this.$refs.treeZL.getCheckedNodes(!0);t.forEach((function(t){e.currentNodeArry.push(t.uid)}));var a="",r=this;this.sdbSelect.forEach((function(e,t,r){a=a+"&logics="+e})),this.axios.get(interfaceObj.SpecialDB_getDataByLogics+a).then((function(t){var a=t.data.data,i=[],l={};a.forEach((function(e,t,a){var s=e["pId"],o=e["id"];if("-1"==s)l[o]=[i.length],e.children=[],i.push(e);else if(l[s]){var n=l[s][0];e.pname=r.setPhysicalName(e.physicalDB),i[n].children.push(e)}})),e.treenode=i,e.checkedKeys=e.currentNodeArry}))},setPhysicalName:function(e){if(e){var t=e.split(",")[0],a="";return this.ruleForm.database.forEach((function(e,r,i){e.id==t&&(a=e.name)})),a}},changeTree:function(e){this.tableData=this.$refs.treeZL.getCheckedNodes(!0)},deleteRow:function(e,t,a){this.$refs.treeZL.setChecked(a,!1),t.splice(e,1)},deleteMuch:function(){var e=this;this.tableSelsectData.length>0?this.$confirm("确定选中数据都删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.tableSelsectData.forEach((function(t,a,r){e.$refs.treeZL.setChecked(t.uid,!1)})),e.tableData=e.tableData.filter((function(t){return!e.tableSelsectData.includes(t)})),console.log(e.tableData)})):this.$message.error("请选择需要删除的文件！")},download:function(){var e=interfaceObj.demoWordUrl+"专题库申请表模板.docx";this.axios.get(interfaceObj.download+"?filepath="+e).then((function(t){testExport(interfaceObj.download+"?filepath="+e)})).catch((function(t){testExport(interfaceObj.download+"?filepath="+e)}))},handleExceed:function(){this.$message.warning("当前限制选择1个文件")},addSpecialDBApply:function(){var e=this,t=new FormData;t.append("TDB_NAME",this.ruleForm.name),t.append("SCHEMA_ID",this.ruleForm.pname),t.append("USES",this.ruleForm.use),t.append("TDB_IMG",this.ruleForm.imageURL);var a=[];this.ruleForm.database.forEach((function(t){e.ruleForm.dbSelect.forEach((function(e){t.name==e&&a.push(t.id)}))})),t.append("DATABASE_ID",a.join(",")),t.append("APPLY_FILE_PATH",this.ruleForm.filepath),t.append("TABLE_DATA",JSON.stringify(this.ruleForm.tableData));var r=this.$store.getters.getLoginUser.userId;this.axios.post(interfaceObj.SpecialDB_addSpecialDBApply+r,t).then((function(t){0==t.data.returnCode?(e.$message({showClose:!0,message:"保存成功，请等待管理员审核",type:"success"}),e.$emit("closedialog")):e.$message.error("申请失败，请联管理员")}))}}}),s=l,o=(a("da1d"),a("2877")),n=Object(o["a"])(s,r,i,!1,null,null,null);t["default"]=n.exports},afa1:function(e,t,a){e.exports=a.p+"static/img/h2.ab690d33.png"},ba76:function(e,t,a){e.exports=a.p+"static/img/h13.c347a4c2.png"},d0e7:function(e,t,a){e.exports=a.p+"static/img/h6.622ca2de.png"},d4c8:function(e,t,a){e.exports=a.p+"static/img/h4.f54d5416.png"},da1d:function(e,t,a){"use strict";var r=a("3451"),i=a.n(r);i.a},dde0:function(e,t,a){e.exports=a.p+"static/img/h1.1bc196c8.png"}}]);