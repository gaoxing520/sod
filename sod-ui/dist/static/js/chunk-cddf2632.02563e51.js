(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cddf2632"],{"0d3a":function(e,t,r){"use strict";r.d(t,"d",(function(){return o})),r.d(t,"j",(function(){return s})),r.d(t,"i",(function(){return i})),r.d(t,"e",(function(){return l})),r.d(t,"a",(function(){return c})),r.d(t,"c",(function(){return u})),r.d(t,"f",(function(){return d})),r.d(t,"g",(function(){return m})),r.d(t,"h",(function(){return g})),r.d(t,"b",(function(){return f})),r.d(t,"k",(function(){return h}));var n=r("b775"),a="http://10.40.79.18:8005";function o(){return Object(n["a"])({url:a+"/schedule/metaClear/findDataBase",method:"get"})}function s(e){return Object(n["a"])({url:a+"/schedule/metaClear/list",method:"get",params:e})}function i(e){return Object(n["a"])({url:a+"/schedule/metaClear/"+e,method:"DELETE"})}function l(e){return Object(n["a"])({url:a+"/schedule/metaClear/findMeta",method:"get",params:e})}function c(e){return Object(n["a"])({url:a+"/schedule/metaClear",method:"post",data:e})}function u(e){return Object(n["a"])({url:a+"/schedule/metaClear",method:"put",data:e})}function d(e){return Object(n["a"])({url:a+"/schedule/metaClear/"+e,method:"get"})}function m(e){return Object(n["a"])({url:a+"/schedule/metaClearLog/list",method:"get",params:e})}function g(e){return Object(n["a"])({url:a+"/schedule/metaClearLog/"+e,method:"get"})}function f(e){return Object(n["a"])({url:a+"/schedule/metaClearLog/"+e,method:"delete"})}function h(e){return Object(n["a"])({url:a+"/schedule/metaClearLog/export",method:"get",params:e,responseType:"arraybuffer"})}},"1fb26":function(e,t,r){"use strict";var n=r("9f17"),a=r.n(n);a.a},"9f17":function(e,t,r){},bd63:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{staticClass:"handleClear"},[r("el-form",{ref:"ruleForm",attrs:{rules:e.rules,model:e.msgFormDialog,"label-width":"140px"}},[r("el-row",[r("el-col",{attrs:{span:10}},[r("el-form-item",{attrs:{label:"任务名称",prop:"taskName"}},[r("el-input",{attrs:{size:"small"},model:{value:e.msgFormDialog.taskName,callback:function(t){e.$set(e.msgFormDialog,"taskName",t)},expression:"msgFormDialog.taskName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"数据库IP"}},[r("el-select",{attrs:{size:"small",filterable:""},on:{change:e.findTree},model:{value:e.msgFormDialog.databaseId,callback:function(t){e.$set(e.msgFormDialog,"databaseId",t)},expression:"msgFormDialog.databaseId"}},e._l(e.ipList,(function(e,t){return r("el-option",{key:t,attrs:{label:e.VAULE,value:e.KEY}})})),1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:20}},[r("el-form-item",{attrs:{label:"执行策略",prop:"jobCron"}},[r("el-input",{attrs:{size:"small"},model:{value:e.msgFormDialog.jobCron,callback:function(t){e.$set(e.msgFormDialog,"jobCron",t)},expression:"msgFormDialog.jobCron"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:4}},[r("el-form-item",{staticClass:"unitFormItem"},[r("el-button",{staticStyle:{padding:"9px 0",width:"100%"},attrs:{size:"small",type:"primary"},on:{click:function(t){e.cronDialogVisible=!0}}},[e._v("配置策略")])],1)],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"where条件",prop:"conditions"}},[r("el-input",{attrs:{size:"small"},model:{value:e.msgFormDialog.conditions,callback:function(t){e.$set(e.msgFormDialog,"conditions",t)},expression:"msgFormDialog.conditions"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:14}},[r("el-form-item",{attrs:{label:"数据库对象"}},[r("el-scrollbar",{attrs:{"wrap-class":"scrollbar-wrapper"}},[r("el-tree",{ref:"eltree",attrs:{"node-key":"nodeKey","show-checkbox":"",data:e.treedata,props:e.defaultProps,"default-checked-keys":e.defaultChecked}})],1)],1)],1)],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.trueDialog("ruleForm")}}},[e._v("确 定")]),e._v(" "),r("el-button",{on:{click:function(t){return e.cancelDialog("ruleForm")}}},[e._v("取 消")])],1),e._v(" "),e.cronDialogVisible?r("Cron",{attrs:{"append-to-body":"",cronDialogVisible:e.cronDialogVisible},on:{closeCron:e.closeCron,setCron:e.setCron}}):e._e()],1)},a=[],o=(r("ac6a"),r("28a5"),r("96cf"),r("3b8d")),s=r("3d09"),i=r("4b67"),l=r("0d3a"),c={name:"handleClear",props:{handleObj:{type:Object}},components:{Cron:s["a"]},data:function(){return{treeJson:[],storageDirectoryOptions:[],cronDialogVisible:!1,defaultChecked:[],msgFormDialog:{taskName:"",databaseId:"",jobCron:"",conditions:""},ipList:[],defaultProps:{children:"children",label:"name"},treedata:[],rules:{taskName:[{required:!0,message:"请输入任务名称",trigger:"blur"}],databaseId:[{required:!0,message:"请选择数据库IP",trigger:"change"}],jobCron:[{required:!0,message:"请输入执行策略",trigger:"blur"}],conditions:[{required:!0,message:"请输入where条件",trigger:"blur"}]}}},created:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["d"])().then((function(e){r.ipList=e.data}));case 2:return e.next=4,this.getDicts("metabackup_storage_directory").then((function(e){r.storageDirectoryOptions=e.data}));case 4:if(!this.handleObj.id){e.next=12;break}return e.next=7,Object(l["f"])(this.handleObj.id).then((function(e){r.msgFormDialog=e.data}));case 7:return e.next=9,this.findTree(this.msgFormDialog.databaseId);case 9:this.defaultChecked=[],t=this.msgFormDialog.clearContent.split(","),t.forEach((function(e){r.treeJson.forEach((function(t){e==t.id&&r.defaultChecked.push(t.nodeKey)}))}));case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),methods:{findTree:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["e"])({databaseId:t}).then((function(e){r.treeJson=e.data,r.treeJson.forEach((function(e){e.nodeKey=e.pid+"+"+e.id})),r.treedata=Object(i["h"])(r.treeJson,"")}));case 2:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),handExe:function(e){this.msgFormDialog.triggerStatus=1},trueDialog:function(e,t){var r=this;this.msgFormDialog.triggerStatus=1;var n=this.$refs.eltree.getCheckedKeys();if(0!=n.length){var a=[];n.forEach((function(e){r.treeJson.forEach((function(t){e==t.nodeKey&&t.pid&&a.push(t.id)}))})),0!=a.length?(this.msgFormDialog.clearContent=a.join(","),console.log(this.msgFormDialog),this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;r.handleObj.id?Object(l["c"])(r.msgFormDialog).then((function(e){200===e.code?(r.msgSuccess("修改成功"),r.$emit("cancelHandle")):r.msgError(e.msg)})):Object(l["a"])(r.msgFormDialog).then((function(e){200===e.code?(r.msgSuccess("新增成功"),r.$emit("cancelHandle")):r.msgError(e.msg)}))}))):this.msgError("数据库对象只能选择子节点")}else this.msgError("请选择数据库对象")},cancelDialog:function(e){this.$emit("cancelHandle")},setCron:function(e){this.msgFormDialog.jobCron=e,this.cronDialogVisible=!1},closeCron:function(){this.cronDialogVisible=!1}}},u=c,d=(r("1fb26"),r("2877")),m=Object(d["a"])(u,n,a,!1,null,null,null);t["default"]=m.exports}}]);